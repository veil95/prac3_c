/* ----------------------------------------------------*/
/* ИМЯ: Савенко Павел ID пользователя: 23К1162 */
/* ДАТА: 06/10/2025 */
/* ИМЯ ФАЙЛА: prog1.c */
/* НАЗНАЧЕНИЕ ПРОГРАММЫ: */
/* Родительский процесс, создающий дочерний процесс */
/* и обрабатывающий сигналы завершения */
/* ----------------------------------------------------*/

#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <signal.h> /* Для работы с сигналами: signal и др. */
#include <sys/wait.h> /* Для ожидания дочерних процессов: wait, waitpid */

/* ----------------------------------------------------*/
/* ФУНКЦИЯ signal_handler : обработчик сигналов */
/* назначение этой функции: обработка сигнала SIGINT */
/* ИСПОЛЬЗОВАНИЕ ПАРАМЕТРА: */
/* int signal - номер полученного сигнала */
/* ВЫЗЫВАЕМАЯ ФУНКЦИЯ: */
/* printf - вывод сообщения на экран */
/* exit - завершение процесса */
/* ----------------------------------------------------*/
void signal_handler(int signal) {
    printf("\n[prog1] Получен сигнал SIGINT (Ctrl+C), завершаем программу...\n");
    exit(0);
}

/* ----------------------------------------------------*/
/* ФУНКЦИЯ main : основная функция родительского процесса */
/* назначение этой функции: создание дочернего процесса */
/* и ожидание его завершения */
/* ВЫЗЫВАЕМАЯ ФУНКЦИЯ: */
/* signal - установка обработчика сигналов */
/* fork - создание дочернего процесса */
/* execl - выполнение другой программы */
/* wait - ожидание завершения дочернего процесса */
/* printf - вывод сообщения на экран */
/* perror - вывод сообщения об ошибке */
/* exit - завершение процесса */
/* ----------------------------------------------------*/
int main() {
    /* Установка обработчика для сигнала SIGINT (Ctrl+C) */
    signal(SIGINT, signal_handler);

    /* Создание дочернего процесса */
    pid_t pid = fork();

    /* Проверка результата создания процесса */
    if (pid < 0) {
        /* Ошибка при создании процесса */
        perror("Ошибка fork");
        exit(1);
    } else if (pid == 0) {
        /* Код выполняется в дочернем процессе */
        /* Запуск программы process.c через exec */
        execl("./process", "process", NULL);
        /* Если exec завершился ошибкой, выводим сообщение */
        perror("ошибка exec");
        exit(1);
    } else {
        /* Код выполняется в родительском процессе */
        /* Сообщение о начале ожидания */
        printf("[prog1] Родительский процесс ждет завершения дочернего...\n");
        
        /* Ожидание завершения дочернего процесса */
        wait(NULL);
        
        /* Сообщение о завершении дочернего процесса */
        printf("[prog1] Дочерний процесс завершен.\n");
    }
    
    return 0;
}
